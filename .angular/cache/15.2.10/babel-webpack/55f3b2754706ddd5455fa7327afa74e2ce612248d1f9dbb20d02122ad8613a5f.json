{"ast":null,"code":"import _asyncToGenerator from \"C:/sistem/MovilPopular/Front-Popular-master/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { UntypedFormGroup, UntypedFormControl, Validators } from '@angular/forms';\nimport { MenuUsuario } from 'app/shared/models/menu.model';\nimport { JwtHelperService } from '@auth0/angular-jwt';\nimport { MatButton } from '@angular/material/button';\nimport { MatProgressBar } from '@angular/material/progress-bar';\nimport { Subject } from 'rxjs';\nimport { Auditoria } from 'app/shared/models/auditoria.model';\nimport { Usuario } from 'app/shared/models/usuario.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"app/shared/services/auth/jwt-auth.service\";\nimport * as i3 from \"app/shared/services/app-loader/app-loader.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/material/snack-bar\";\nimport * as i6 from \"app/shared/services/menu.service\";\nimport * as i7 from \"app/shared/services/auditoria.service\";\nimport * as i8 from \"app/shared/services/navigation.service\";\nimport * as i9 from \"keycloak-angular\";\nimport * as i10 from \"@angular/common\";\nimport * as i11 from \"@angular/material/legacy-checkbox\";\nimport * as i12 from \"@angular/material/legacy-button\";\nimport * as i13 from \"@angular/material/legacy-form-field\";\nimport * as i14 from \"@angular/material/legacy-input\";\nimport * as i15 from \"@angular/material/legacy-core\";\nimport * as i16 from \"@angular/material/legacy-select\";\nimport * as i17 from \"@angular/material/divider\";\nimport * as i18 from \"@angular/flex-layout/flex\";\nimport * as i19 from \"../../../shared/components/perfect-scrollbar/perfect-scrollbar.directive\";\nfunction SigninComponent_mat_option_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 17);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const p_r1 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", p_r1.idparticipe);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", p_r1.descripcion, \" \");\n  }\n}\nconst _c0 = function () {\n  return {};\n};\nexport let SigninComponent = /*#__PURE__*/(() => {\n  class SigninComponent {\n    constructor(fb, jwtAuth, egretLoader, router, route, _snackBar, menuService, auditoriaService, navigationService, keycloak) {\n      this.fb = fb;\n      this.jwtAuth = jwtAuth;\n      this.egretLoader = egretLoader;\n      this.router = router;\n      this.route = route;\n      this._snackBar = _snackBar;\n      this.menuService = menuService;\n      this.auditoriaService = auditoriaService;\n      this.navigationService = navigationService;\n      this.keycloak = keycloak;\n      this.isLogueado = false;\n      this.perfilUsuario = null;\n      this.messageChange = new Subject();\n      this.errorMsg = '';\n      this.tipoparticipe = [{\n        'idparticipe': '1',\n        'descripcion': 'Individual'\n      }, {\n        'idparticipe': '2',\n        'descripcion': 'Copropiedad'\n      }, {\n        'idparticipe': '3',\n        'descripcion': 'Sucesión'\n      }];\n      this.getMenuData = [];\n      this.validaPass = 0;\n      this.isAuth = false;\n      this._unsubscribeAll = new Subject();\n      this.validaPass = 0;\n    }\n    ejecuto(event) {\n      this.idtipoparticipeSelected = event.value;\n    }\n    iniciarSession() {\n      this.keycloak.login();\n    }\n    cerrarSession() {\n      this.keycloak.logout();\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        _this.isLogueado = yield _this.keycloak.isLoggedIn();\n        if (_this.isLogueado) {\n          _this.perfilUsuario = yield _this.keycloak.loadUserProfile();\n        }\n        _this.signinForm = new UntypedFormGroup({\n          username: new UntypedFormControl(_this.username, Validators.required),\n          password: new UntypedFormControl(_this.password, Validators.required),\n          rememberMe: new UntypedFormControl(true),\n          idtipoparticipeSelected: new UntypedFormControl(_this.idtipoparticipeSelected, Validators.required)\n        });\n      })();\n    }\n    ngAfterViewInit() {\n      //this.autoSignIn();\n    }\n    ngOnDestroy() {\n      this._unsubscribeAll.next(1);\n      this._unsubscribeAll.complete();\n    }\n    signin() {\n      if (this.signinForm.invalid) {\n        return;\n      }\n      const signinData = this.signinForm.value;\n      this.usuario = new Usuario(this.username, \"\", \"\", \"\", \"\", \"\", \"\", this.idtipoparticipeSelected);\n      this.jwtAuth.listapermiso(this.usuario).subscribe(data => {\n        console.log(data);\n        this.validaPass = data;\n        if (this.validaPass.valueOf() < 3) {\n          this.jwtAuth.signin(this.username, this.password, this.idtipoparticipeSelected).subscribe(response => {\n            const helper = new JwtHelperService();\n            let token = JSON.stringify(response);\n            sessionStorage.setItem(this.jwtAuth.JWT_TOKEN, token);\n            let tk = JSON.parse(sessionStorage.getItem(this.jwtAuth.JWT_TOKEN));\n            const decodedToken = helper.decodeToken(tk.access_token);\n            this.menuUsuario = new MenuUsuario(this.username, this.idtipoparticipeSelected);\n            this.menuService.lista(this.menuUsuario).subscribe(data => {\n              this.getMenuData = data;\n              let datosusuario = JSON.stringify(data);\n              let datosparse = JSON.parse(datosusuario);\n              this.infousu = datosparse[0].usuario.nombre + \" \" + datosparse[0].usuario.apellido;\n              this.jwtAuth.user = {\n                'id': '5b700c45639d2c0c54b354ba',\n                displayName: this.infousu,\n                role: datosparse[0].usuario.roles[0].name,\n                username: datosparse[0].usuario.username,\n                cparticipe: datosparse[0].usuario.cparticipe,\n                usuario_id: datosparse[0].usuario.usuario_id,\n                idtipoparticipe: this.idtipoparticipeSelected,\n                correo: datosparse[0].usuario.email,\n                pass: this.password\n              };\n              this.jwtAuth.user.username = datosparse[0].usuario.username;\n              this.jwtAuth.user.cparticipe = datosparse[0].usuario.cparticipe;\n              this.jwtAuth.user.role = datosparse[0].usuario.roles[0].name, this.jwtAuth.user.usuario_id = datosparse[0].usuario.usuario_id;\n              this.jwtAuth.user.idtipoparticipe = this.idtipoparticipeSelected;\n              this.jwtAuth.user.correo = datosparse[0].usuario.email;\n              this.jwtAuth.user.pass = this.password;\n              this.cparticipe = datosparse[0].usuario.cparticipe;\n              this.usuario_id = datosparse[0].usuario.usuario_id;\n              localStorage.getItem(this.jwtAuth.JWT_TOKEN);\n              datosparse[0].usuario.email, this.jwtAuth.traerIP().subscribe(data => {\n                let date = new Date();\n                let ip = JSON.stringify(data.ip);\n                this.miip = ip;\n                this.auditoria = new Auditoria(this.miip, this.usuario_id, this.username, \"logueandose\", this.idtipoparticipeSelected, this.cparticipe, date);\n                this.auditoriaService.insertar(this.auditoria).subscribe();\n              });\n              this.navigationService.sendObjectSource(data);\n              const resul = this.tipoparticipe.find(x => x.idparticipe == this.idtipoparticipeSelected);\n              this.jwtAuth.idtipoparticipe = this.idtipoparticipeSelected;\n              this.jwtAuth.descripcion = resul.descripcion;\n              this.isLogueado = true;\n              this.jwtAuth.isLoggedIn(true);\n              this._snackBar.open(\"Accediendo\", 'INFO', {\n                duration: 1000,\n                horizontalPosition: 'right',\n                verticalPosition: 'top'\n              });\n              this.router.navigate(['/reporte/resumen']);\n            });\n          }, err => {\n            this.validaPass = this.validaPass.valueOf() + 1;\n            this.isLogueado = false;\n            this.usuario = new Usuario(this.username, \"\", \"\", \"\", \"\", \"\", \"\", this.idtipoparticipeSelected);\n            this.jwtAuth.permisousu(this.usuario).subscribe(data => {\n              console.log(data);\n            });\n            //this.submitButton.disabled = false;\n            // this.progressBar.mode = 'determinate';\n            this._snackBar.open(\"Verificar datos\", 'INFO', {\n              duration: 2000,\n              horizontalPosition: 'right',\n              verticalPosition: 'top'\n            });\n          });\n        } else {\n          this.usuario = new Usuario(this.username, \"\", \"\", \"\", \"\", \"\", \"\", this.idtipoparticipeSelected);\n          this.jwtAuth.permisobloq(this.usuario).subscribe();\n          this.isLogueado = false;\n          this._snackBar.open(\"Clave esta bloqueada\", 'INFO', {\n            duration: 2000,\n            horizontalPosition: 'right',\n            verticalPosition: 'top'\n          });\n        }\n      });\n    }\n    olvidoClave() {\n      if (this.validaPass.valueOf() < 3) {\n        this.router.navigate(['/sessions/forgot-password']);\n      } else {\n        this._snackBar.open(\"Clave esta bloqueada\" + this.validaPass, 'INFO', {\n          duration: 3000,\n          horizontalPosition: 'right',\n          verticalPosition: 'top'\n        });\n      }\n    }\n    autoSignIn() {\n      if (this.jwtAuth.return === '/') {\n        return;\n      }\n      this.egretLoader.open(`Automatically Signing you in! \\n Return url: ${this.jwtAuth.return.substring(0, 20)}...`, {\n        width: '320px'\n      });\n      setTimeout(() => {\n        this.signin();\n        this.egretLoader.close();\n      }, 2000);\n    }\n    openSnackBar(message, action) {\n      this._snackBar.open(message, action);\n    }\n  }\n  SigninComponent.ɵfac = function SigninComponent_Factory(t) {\n    return new (t || SigninComponent)(i0.ɵɵdirectiveInject(i1.UntypedFormBuilder), i0.ɵɵdirectiveInject(i2.JwtAuthService), i0.ɵɵdirectiveInject(i3.AppLoaderService), i0.ɵɵdirectiveInject(i4.Router), i0.ɵɵdirectiveInject(i4.ActivatedRoute), i0.ɵɵdirectiveInject(i5.MatSnackBar), i0.ɵɵdirectiveInject(i6.MenuService), i0.ɵɵdirectiveInject(i7.AuditoriaService), i0.ɵɵdirectiveInject(i8.NavigationService), i0.ɵɵdirectiveInject(i9.KeycloakService));\n  };\n  SigninComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: SigninComponent,\n    selectors: [[\"app-signin\"]],\n    viewQuery: function SigninComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(MatProgressBar, 5);\n        i0.ɵɵviewQuery(MatButton, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.progressBar = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.submitButton = _t.first);\n      }\n    },\n    decls: 32,\n    vars: 9,\n    consts: [[1, \"seciton-left\"], [1, \"form-holder\", \"h-full-screen\", \"mat-bg-card\", \"mat-elevation-z4\", 3, \"perfectScrollbar\"], [\"fxLayout\", \"column\", 1, \"signup-form\", 3, \"formGroup\", \"ngSubmit\"], [1, \"form-headline\", \"text-center\", \"mb-32\"], [1, \"font-weight-light\"], [\"fxLayout\", \"row wrap\", \"fxLayoutAlign\", \"center center\", 1, \"mb-48\"], [\"width\", \"600px\", \"src\", \"assets/Logo.jpg\", \"alt\", \"\"], [1, \"full-width\"], [\"placeholder\", \"seleccionar tipoparticipe\", \"formControlName\", \"idtipoparticipeSelected\", 3, \"ngModel\", \"selectionChange\", \"ngModelChange\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"appearance\", \"outline\", 1, \"full-width\"], [\"matInput\", \"\", \"formControlName\", \"username\", \"type\", \"username\", \"name\", \"username\", \"placeholder\", \"username\", 3, \"ngModel\", \"ngModelChange\"], [\"matInput\", \"\", \"formControlName\", \"password\", \"type\", \"password\", \"name\", \"password\", \"placeholder\", \"********\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"rememberMe\", 3, \"formControl\"], [\"mat-raised-button\", \"\", \"color\", \"primary\"], [1, \"my-32\"], [1, \"mat-color-primary\", \"colortexto\", \"text-center\", \"full-width\", 3, \"click\"], [3, \"value\"]],\n    template: function SigninComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1)(2, \"form\", 2);\n        i0.ɵɵlistener(\"ngSubmit\", function SigninComponent_Template_form_ngSubmit_2_listener() {\n          return ctx.signin();\n        });\n        i0.ɵɵelementStart(3, \"div\", 3)(4, \"h1\", 4);\n        i0.ɵɵtext(5, \"BIENVENIDO\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(6, \"div\", 5);\n        i0.ɵɵelement(7, \"img\", 6);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"mat-form-field\", 7)(9, \"mat-select\", 8);\n        i0.ɵɵlistener(\"selectionChange\", function SigninComponent_Template_mat_select_selectionChange_9_listener($event) {\n          return ctx.ejecuto($event);\n        })(\"ngModelChange\", function SigninComponent_Template_mat_select_ngModelChange_9_listener($event) {\n          return ctx.idtipoparticipeSelected = $event;\n        });\n        i0.ɵɵtemplate(10, SigninComponent_mat_option_10_Template, 2, 2, \"mat-option\", 9);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(11, \"DIV\")(12, \"mat-form-field\", 10)(13, \"mat-label\");\n        i0.ɵɵtext(14, \"DNI\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"input\", 11);\n        i0.ɵɵlistener(\"ngModelChange\", function SigninComponent_Template_input_ngModelChange_15_listener($event) {\n          return ctx.username = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(16, \"mat-form-field\", 10)(17, \"mat-label\");\n        i0.ɵɵtext(18, \"Password\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(19, \"input\", 12);\n        i0.ɵɵlistener(\"ngModelChange\", function SigninComponent_Template_input_ngModelChange_19_listener($event) {\n          return ctx.password = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelement(20, \"br\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(21, \"br\")(22, \"br\");\n        i0.ɵɵelementStart(23, \"mat-checkbox\", 13);\n        i0.ɵɵtext(24, \"Recuerdame en este dispositivo\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(25, \"mat-label\");\n        i0.ɵɵtext(26);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(27, \"button\", 14);\n        i0.ɵɵtext(28, \" Ingresar \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(29, \"mat-divider\", 15);\n        i0.ɵɵelementStart(30, \"a\", 16);\n        i0.ɵɵlistener(\"click\", function SigninComponent_Template_a_click_30_listener() {\n          return ctx.olvidoClave();\n        });\n        i0.ɵɵtext(31, \"Olvido su contrase\\u00F1a\");\n        i0.ɵɵelementEnd()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"perfectScrollbar\", i0.ɵɵpureFunction0(8, _c0));\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"formGroup\", ctx.signinForm);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngModel\", ctx.idtipoparticipeSelected);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.tipoparticipe);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngModel\", ctx.username);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngModel\", ctx.password);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"formControl\", ctx.signinForm.controls[\"rememberMe\"]);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.errorMsg);\n      }\n    },\n    dependencies: [i10.NgForOf, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormControlDirective, i1.FormGroupDirective, i1.FormControlName, i11.MatLegacyCheckbox, i12.MatLegacyButton, i13.MatLegacyFormField, i13.MatLegacyLabel, i14.MatLegacyInput, i15.MatLegacyOption, i16.MatLegacySelect, i17.MatDivider, i18.DefaultLayoutDirective, i18.DefaultLayoutAlignDirective, i19.PerfectScrollbarDirective],\n    styles: [\".colortexto[_ngcontent-%COMP%]{color:#00f;text-decoration:underline}\"]\n  });\n  return SigninComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}